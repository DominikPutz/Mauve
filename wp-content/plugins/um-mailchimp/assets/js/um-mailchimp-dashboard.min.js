var um_admin_scripts,um_mailchimp_data,um_mailchimp_create_template=function(a,t){if(jQuery("#tmpl-"+a).length){var m=wp.template(a),e="um_mailchimp_template_"+(new Date).getMilliseconds();return void 0===window.um_mailchimp_dashboard_data&&(window.um_mailchimp_dashboard_data={}),window.um_mailchimp_dashboard_data[e]={template:m,data:t},e}},um_mailchimp_render_template=function(a,t){if(void 0!==window.um_mailchimp_dashboard_data[a]){var m=window.um_mailchimp_dashboard_data[a].template(window.um_mailchimp_dashboard_data[a].data);return void 0!==t&&(window.um_mailchimp_dashboard_data[a].object=t),window.um_mailchimp_dashboard_data[a].object.html(m),!0}return!1},um_mailchimp_update_template=function(a,t){if(t=t||{},void 0!==window.um_mailchimp_dashboard_data[a]){for(var m in t)window.um_mailchimp_dashboard_data[a].data[m]=t[m];return um_mailchimp_render_template(a)}return!1};function um_mc_ajax_sync_now(a){a.preventDefault();var t=jQuery(".um_mailchimp_sync_list").val();um_mailchimp_update_template(window.um_sync_now,{button_disabled:!0,message:um_mailchimp_data.labels.sync_message,loading:!0,list:t}),function m(e){m.tmpData=m.tmpData||{action:"um_mailchimp_sync_now",nonce:um_admin_scripts.nonce,key:window.sync_key||"",list_id:e,message:"",length:0,offset:0,subtotal:0,total:0};jQuery.post(wp.ajax.settings.url,m.tmpData).done(function(a){if(a.success){var t=jQuery.extend(m.tmpData,a.data);um_mailchimp_update_template(window.um_sync_now,{message:t.message,loading:!0}),t.total-t.offset>t.length?(m.tmpData.offset=t.offset+t.length,m(e)):setTimeout(function(){window.location=um_mailchimp_data.current_url},1e3)}else um_mailchimp_update_template(window.um_sync_now,{message:a.data,loading:!1}),console.error(a)}).fail(function(a,t,m){alert(t+" "+m)})}(t)}function um_mc_ajax_scan_now(a){a.preventDefault();var t=jQuery(".um_mailchimp_user_role").val(),m=jQuery(".um_mailchimp_user_status").val();um_mailchimp_update_template(window.um_scan_now,{button_disabled:!0,message:um_mailchimp_data.labels.scan_message,loading:!0,role:t,status:m}),jQuery.post(wp.ajax.settings.url,{action:"um_mailchimp_scan_now",role:t,status:m,nonce:um_admin_scripts.nonce},function(a){a.success?(window.umMcBulcAction={key:a.data.key,role:t,status:m,batches:[]},a.data.total?um_mailchimp_update_template(window.um_scan_now,{button_disabled:!0,loading:!1,message:a.data.message,step:2}):um_mailchimp_update_template(window.um_scan_now,{button_disabled:!1,loading:!1,message:a.data.message,step:0})):alert(a.data)}).fail(function(a,t,m){alert(t+" "+m)})}function um_mc_ajax_bulk_action(a){a.preventDefault();var t=jQuery(".um_mailchimp_list").val(),m=jQuery(a.currentTarget),i="",e="";"btn_um_mailchimp_bulk_subscribe"===m.attr("id")&&(i="um_mailchimp_bulk_subscribe",e=um_mailchimp_data.labels.start_bulk_subscribe_process),"btn_um_mailchimp_bulk_unsubscribe"===m.attr("id")&&(i="um_mailchimp_bulk_unsubscribe",e=um_mailchimp_data.labels.start_bulk_unsubscribe_process),um_mailchimp_update_template(window.um_scan_now,{button_disabled:!0,loading:!0,message:e,internal_list:t}),function m(e){m.tmpData=m.tmpData||jQuery.extend(window.umMcBulcAction,{action:i,nonce:um_admin_scripts.nonce,list_id:e,message:"",length:0,offset:0,subtotal:0,total:0});jQuery.post(wp.ajax.settings.url,m.tmpData,function(a){if(a.success){var t=jQuery.extend(m.tmpData,a.data);window.umMcBulcAction.batches.push(t.batch),um_mailchimp_update_template(window.um_scan_now,{message:t.message,loading:!0}),t.total-t.offset>t.length?(m.tmpData.offset=t.offset+t.length,m(e)):setTimeout(function(){window.location=um_mailchimp_data.current_url},1e3)}else um_mailchimp_update_template(window.um_scan_now,{message:a.data,loading:!1}),console.error(a)}).fail(function(a,t,m){alert(t+" "+m)})}(t)}window.um_sync_now=um_mailchimp_create_template("um-mailchimp-sync-metabox",jQuery.extend(um_mailchimp_data,{button_disabled:!0})),window.um_sync_now&&um_mailchimp_render_template(window.um_sync_now,jQuery("#um-mailchimp-sync-metabox-wrapper")),window.um_scan_now=um_mailchimp_create_template("um-mailchimp-subscribe-metabox",jQuery.extend(um_mailchimp_data,{button_disabled:!1})),window.um_scan_now&&um_mailchimp_render_template(window.um_scan_now,jQuery("#um-mailchimp-subscribe-metabox-wrapper")),jQuery(document).on("click","#btn_um_mailchimp_sync_now:not(.disabled)",um_mc_ajax_sync_now).on("click","#btn_um_mailchimp_scan_now:not(.disabled)",um_mc_ajax_scan_now).on("click","#btn_um_mailchimp_bulk_subscribe:not(.disabled)",um_mc_ajax_bulk_action).on("click","#btn_um_mailchimp_bulk_unsubscribe:not(.disabled)",um_mc_ajax_bulk_action).on("change",".um_mailchimp_sync_list",function(a){um_mailchimp_update_template(window.um_sync_now,{button_disabled:!1,internal_list:a.target.value})}).on("change",".um_mailchimp_list",function(a){um_mailchimp_update_template(window.um_scan_now,{button_disabled:!1,internal_list:a.target.value})});